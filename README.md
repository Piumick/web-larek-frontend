https://github.com/Piumick/web-larek-frontend.git


# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка 

```
npm run build
```

или

```
yarn build
```


## Данные и типы данных использованных в приложении

Данные карточки товара
```
export interface ICard {
  id: string
  title: string;
  description: string;
  image: string;
  category: string;
  price: number;
}
```

Данные карточки товара, используемые на главной странице с каталогом
```
export type TCardInCatalog = Pick<ICard, 'title' | 'image' | 'category' | 'price'>
```

Данные карточки товара, используемые в окне с подробной информацией
```
export type TcardInfo = Pick<ICard, 'title' | 'price' | 'image' | 'category' | 'description'>
```

Данные карточки товара, используемые в отображении в корзине
```
export type TCardInBusket = Pick<ICard, 'title' | 'price'>
```


Данные заказа
```
export interface IOrder{
  payment: paymentMetod;
  email: string;
  phone: string;
  adress: string;
  total: number;
  items: string[]
}
```
Данные корзины

```
export interface IBusket{
  goods: TCardInBusket[];
  total: number;
}
```
Данные суммы заказа
```
export type TTotalPrice = Pick<IBusket, 'total'>
```
Данные доступные для выбора в графе способ оплаты
```
type paymentMetod = 'online' | 'ofline';
```


## Архетектура приложения
Используется архетектурный шаблон MVP, который подразумевает деление кода на 3 слоя: Model, View, Presenter 

#### Model 
(Модель) работает с данными, проводит вычисления и руководит всеми бизнес-процессами.

#### View
(Вид или представление) показывает пользователю интерфейс и данные из модели.

#### Presenter
(Представитель) служит прослойкой между моделью и видом.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов.


Конструктор:

- constructor(baseUrl: string, options: RequestInit = {}) В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов:

Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - принимает ответ от сервера, если статус - OK - возвращает объект ответа в промисе. В противном случае возвращает объект Promise, который был отклонён по причине: data.error.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой model

#### class BusketData
отвечает за хранение и логику работы с данными корзины.

Конеструктор принимает экземпляр EventEmiter м присваевает пустой массив полю goods для корректной работы проверки на присутствие в корзине товара: 
constructor( events: IEvents){
    this.events = events
    this.goods = []
  }

В полях объекта храняться следующие данные:
- goods: ICard[] - массив обьектов товаров.
- events: IEvents - Экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Также объект предоставляет набор методов для работы с этими данными.
- getBusketData(): ICard[] - возвращает массив объектов товаров
- clearBusket(): void; - очищает массив объектов товаров
- addProdukt(productId: string): void - принимает ID товара в параметрах и добавляет товар с таким ID в массив объектов товаров
- deleteProduct(productId: string): void - принимает ID товара в параметрах и удаляет товар с таким ID из массива объектов товаров
- getTotal(): number - возвращает сумму стоимостей всех товаров в корзине
- getCount(): number - возвращает кол-во товаров в корзине
- checkValidation(): boolean - проверяет корзину на пустоту и наличие непродаваемого товара, возвращает true если все правила соблюдены и false в обратном случае.


#### Класс OrderData 
Отвечает за хранение и логику работы с данными заказа.

 Конструктор:
- constructor(items: string[], events: IEvents) конструктор класса принимает массив ID товаров и инстант брокера событий

В полях класса храняться следующие данные:\
- _payment: paymentMetod - данные о способе оплаты
- _email: string - email адресс заказчика
- _phone: string - моб. телефон заказчика
- _adress: string - адрес заказчика
- items: ICard[] - массив товаров  

Также клас предоставляет набор методов для работы с этими данными.

- getOrderInfo(): IOrder - возвращает данные о заказе
- checkOrderFormValidation() - проверяет поля с данными заказа на валидность.
- checkOrderFormValidation() - проверяет поля с данными пользователя на валидность.
- getTotal: (items: ШСфкв[]): number - вычисляет и возвращает сумму заказа

 Набор сеттеров для сохранения данных в поля класса:
- set payment(value: string),
- set email(value: string),
- set phone(value: string),
- set adress(value: string),

#### Класс CardsData 
отвечает за хранение и работу с массивом товаров.
Поля:
 _catalog: ICard[] -  массив товаров

Методы: getById(id:string) - принимает id и возвращает товар с таким id 
а также сеттер и геттер catalog для записи и получения массива товаров.

### Слой View
Все классы представления отвечают за отображения внутри контейнера (DOM елемент) переданных в них данных

#### Класс Component

Реализует базовую логику работы с компонентами отображения:
конструктор:

constructor(protected readonly container: HTMLElement){
    }

метод:

render(data?: Partial<T>): HTMLElement{
    Object.assign(this as object, data ?? {});
    return this.container
}
принимает частичную или полную вариацию обьекта с данными, которые нужно отобразить в элементе, и возвращает HTMLElement



#### Класс Modal
Предназначен для работы с модальными окнами.

конструктор:
``` 
constructor(modal: HTMLElement, events: IEvents)
```
Принимает коренной элемент модального окна, и инстанс брокера событий, записывает в соответсвующие поля класса елементы с изменяемыми данными, создает обработчики событий 

Также предоставляет набор методов для работы с моддальными окнами:
- open() - добавляет нужные для отображения модального окна классы, и навешивает обработчик событий на закрытие по кнопке esc.
- close() - уберает те же классы, что-бы скрыть модальное окно, и снимает обработчик.
- handleEscUp(evt: KeyboardEvent) - функия закрытия по нажатию на кнопку esc
- set content(content: HTMLElement) - задает контент модального окна.

#### Класс Card
является родительским для всех вариантов отображения карточки товара, наследуется от класса container.
```
constructor(protected container: HTMLElement, events: IEvents)
```
 Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- deleteCard(): удаляет карточку
- render(cardData?: Partial<ICard>): HTMLElement - заполняет поступившие данные и возвращает карточку

а также набор сеттеров для коректной работы метода render/


#### Класс CardFull 
Расширяет класс card предоставляя метод для работы с кнопкой и уникальные для данного отображения поля

#### Класс CardInBasket
Расширяет класс card предаставляя уникальные для данного отображения поля.

#### Класс CardInCatalog
Расширяет класс card предаставляя уникальные поля для данного отображения, также вешает обработчик на карточку.

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице.
```
constructor(container: HTMLElement)
```
В конструктор принимает контейнер, в котором размещаются карточки.
Метод: 
set catalog(items:HTMLElement[])
принимает массив и заполняет им контейнер.

#### Класс Form
Отвечает за работу с формами.
конструктор:
```
constructor(protected container: HTMLElement, events:IEvents)
```
в зависимости от вида формы заполняет нужные поля класса и вешает нужные обработчики событий

Поля класса:

 - protected inputs: NodeListOf<HTMLInputElement> - массив инпутов формы
 - protected altButtons: NodeListOf<HTMLButtonElement> - массив кнопок выбора способа оплаты
 - protected submitButton: HTMLButtonElement; - кнопка подтверждения
 - protected formName: string; - имя формы для генерации именных событий
 - protected _form: HTMLFormElement - сам элемент формы
 - protected events: IEvents - инстант EventEmiter для генерации событий
 
Методы: 
 - protected getInputValues() - возвращает обьект со всеми полями - значениями формы.
 - togleAltButtons(button: HTMLButtonElement, buttons: NodeListOf<HTMLButtonElement>) - переключает кнопки вобора способа оплаты.
 - togleSubmitButton(isValid: boolean) - переключает кнопку подтверждения.
 - formReset() - очищает все поля формы.

 #### Класс OrderSuccess 
 отвечает за контент модального окна с подтверждением заказа

 Поля класса: 
 - protected _total: HTMLElement; - сумма заказа
 - protected button: HTMLButtonElement; - кнопка закрытия окна.

 Конструктор: 
 ```
constructor(element: HTMLElement, events: IEvents)
 ```
 принимает елемент и инстант брокера событий
 заполняет поля, и вешает обработчик на кнопку.

#### Класс BasketInfo
отвечает за отображение суммы заказа в корзине, кнопку корзины и кол-во товаров рядом с кнопкой корзины в header.
поля класса:
protected events : IEvents - инстант брокера событий
protected basketCounter : HTMLElement; - кол-во товаров рядом с кнопкой корзины
protected basketButton : HTMLButtonElement - кнопка корзины
protected basketPrice : HTMLElement - сумма заказа.

Конструктор: 
 ```
constructor(element: HTMLElement, events: IEvents)
 ```
 принимает елемент и инстант брокера событий
 заполняет поля, и вешает обработчик на кнопку.

методы:
 - render(basketData?: Partial<IBasketInfo>) - заполняет пришедшие в параметрах данные.
 - toogleBasketButton(isValid: boolean) - принает булевое значение и в зависимости от него активирует или деактивирует кнопку корзины.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `busket:changed` - изменение массива карзины

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `cardFull:open` - открытие модального окна с карточкой с подробной информацией о товаре
- `card:toogle` - изменение позиции товара в корзине.
- `busket:open` - открытие модального корзины
- `order:open` - открытие модального окна с формой данных о заказе
- `success:open` - открытие модального окна с сообщением о создании заказа и суммой заказа
- `${this.formName}:input` - изменение данных в инпуте формы.
- `${this.formName}:submit` - сабмит формы.
- `success:close` - закрытие модального окна с сообщением о создании заказа и суммой заказа
- `card:add` - добавление товара в корзину
- `card:delete` - удаление карточки из корзины





